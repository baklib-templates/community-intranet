{% assign pages = page.pages_in_list %}
{% assign pages_count  = pages | size %}

{% unless pages_count %}
    {% render 'demo_faqs' %}
{% else %}
    <main class="grow bg-white">
        <div class="px-4 sm:px-6 lg:px-8 py-8 w-full max-w-9xl mx-auto">

            <div class="max-w-3xl m-auto">

                <!-- Page title -->
                <div class="mb-5">
                    <h1 class="flex items-center text-2xl md:text-4xl text-gray-800 font-bold">
                        <img src="{{ page.settings.icon | default: '👏'}}" class="w-10 h-10 mr-2"/>
                        {{ page.link_text }}</h1>
                    <p class="text-sm text-gray-600 mt-2">{{ page.settings.description }}</p>
                </div>

                <!-- Search form -->
                <div class="mb-6">
                    {% form_tag 'search', class: 'relative' %}
                        <label for="action-search" class="sr-only">Search</label>
                        <input name="{{form.keywords_field_name}}" value="{{ search.keywords | escape_once }}" id="action-search" class="form-input pl-9 py-3 dark:bg-gray-800 dark:text-white focus:border-gray-300 w-full"
                            type="search">
                        <button class="absolute inset-0 right-auto group" type="submit" aria-label="Search">
                            <svg class="shrink-0 fill-current text-gray-400  group-hover:text-gray-500 ml-3 mr-2"
                                width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M7 14c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zM7 2C4.243 2 2 4.243 2 7s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5z">
                                </path>
                                <path
                                    d="M15.707 14.293L13.314 11.9a8.019 8.019 0 01-1.414 1.414l2.393 2.393a.997.997 0 001.414 0 .999.999 0 000-1.414z">
                                </path>
                            </svg>
                        </button>
                    {% endform_tag %}
                </div>

                <!-- Filters -->
                <div class="mb-4 border-b border-gray-200">
                    <ul class="text-sm font-medium flex flex-nowrap -mx-4 sm:-mx-6 lg:-mx-8 overflow-x-scroll no-scrollbar">
                        <li
                            class="pb-3 mr-6 last:mr-0 first:pl-4 sm:first:pl-6 lg:first:pl-8 last:pr-4 sm:last:pr-6 lg:last:pr-8">
                            <a class="{% unless params['tag'] %} text-primary underline {% endunless %} whitespace-nowrap" href="{{ page.path }}">All</a>
                        </li>
                        {% for tag in page.settings.tags %}
                            <li class="pb-3 mr-6 last:mr-0 first:pl-4 sm:first:pl-6 lg:first:pl-8 last:pr-4 sm:last:pr-6 lg:last:pr-8">
                                <a class="{% if tag.name == params['tag'] %} text-primary underline {% endif %} hover:text-gray-600 whitespace-nowrap"
                                    href="{{ page.path |  append: '?tag=' |  append: tag.name }}">{{ tag.name }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Posts -->
                <div>
                    {% paginate_tag pages, per: 9 %}
                    {% for item in pages %}
                        {% assign tag_names = item.settings.tags | map: 'name' %}
                        {% if params['tag'] == nil or (params['tag'] and (tag_names contains params['tag'])) %} 
                            <!-- Post -->
                            <article class="py-4 border-b border-gray-200">
                                <header class="flex items-start mb-2">
                                    <div class="mt-2 mr-3">
                                        <svg class="shrink-0 fill-current" width="16" height="16" viewBox="0 0 16 16">
                                            <path class="text-primary-300" d="M4 8H0v4.9c0 1 .7 1.9 1.7 2.1 1.2.2 2.3-.8 2.3-2V8z">
                                            </path>
                                            <path class="text-primary-500"
                                                d="M15 1H7c-.6 0-1 .4-1 1v11c0 .7-.2 1.4-.6 2H13c1.7 0 3-1.3 3-3V2c0-.6-.4-1-1-1z">
                                            </path>
                                        </svg>
                                    </div>
                                    <h3 class="text-xl leading-snug text-gray-800 font-bold">{{ item.link_text }}
                                    </h3>
                                </header>
                                <div class="pl-7">
                                    <div class="mb-2">
                                        <div class="line-clamp-6"
                                            {{ item.settings.content }}
                                        </div>
                                        <a href="{{ item.path }}" class="text-blue-600">展开更多...</a>
                                    </div>
                                    <ul class="flex flex-wrap">
                                        {% for tag in item.settings.tags %}
                                        <li
                                            class="flex items-center after:block after:content-['·'] last:after:content-[''] after:text-sm after:text-gray-400 dark:after:text-gray-600 after:px-2">
                                            <a class="text-sm font-medium text-slate-500 hover:text-slate-600 dark:hover:text-slate-400"
                                                href="{{ tag.path }}">{{ tag.name }}</a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </article>
                        {% endif %}
                    {% endfor %}

                    <!-- Pagination -->
                    <div class="mt-6">
                        <div class="flex justify-end">
                            {% render 'paginate', paginate: paginate %}
                        </div>
                    </div>
                    {% endpaginate_tag %}

                </div>

            </div>

        </div>
    </main>
{% endunless %}

{% schema %}
{
    "name": "Faqs",
    "description": "FAQ多Tab页面列表",
    "thumb_url": "images/theme/faqs.png",
    "sub_page_templates": ["post"],
    "settings": [
        {
            "id": "tags",
            "type": "tag_picker",
            "multiple": true,
            "label": "标签"
        },
        {
            "id": "description",
            "type": "textarea",
            "label": "描述"
        },
        {
            "id": "icon",
            "type": "image_picker",
            "ratio": "1:1",
            "width": 100,
            "label": "图标"
        }
    ]
}
{% endschema %}
